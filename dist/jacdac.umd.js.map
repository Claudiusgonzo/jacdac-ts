{"version":3,"file":"jacdac.umd.js","sources":["../src/constants.ts","../src/utils.ts","../src/bus.ts","../src/packet.ts","../src/device.ts","../src/hf2.ts","../src/pretty.ts"],"sourcesContent":["\r\n// Registers 0x001-0x07f - r/w common to all services\r\n// Registers 0x080-0x0ff - r/w defined per-service\r\n// Registers 0x100-0x17f - r/o common to all services\r\n// Registers 0x180-0x1ff - r/o defined per-service\r\n// Registers 0x200-0xeff - custom, defined per-service\r\n// Registers 0xf00-0xfff - reserved for implementation, should not be on the wire\r\n\r\n// this is either binary (0 or non-zero), or can be gradual (eg. brightness of neopixel)\r\nexport const REG_INTENSITY = 0x01\r\n// the primary value of actuator (eg. servo angle)\r\nexport const REG_VALUE = 0x02\r\n// enable/disable streaming\r\nexport const REG_IS_STREAMING = 0x03\r\n// streaming interval in miliseconds\r\nexport const REG_STREAMING_INTERVAL = 0x04\r\n// for analog sensors\r\nexport const REG_LOW_THRESHOLD = 0x05\r\nexport const REG_HIGH_THRESHOLD = 0x06\r\n// limit power drawn; in mA\r\nexport const REG_MAX_POWER = 0x07\r\n\r\n// eg. one number for light sensor, all 3 coordinates for accelerometer\r\nexport const REG_READING = 0x101\r\n\r\nexport const CMD_GET_REG = 0x1000\r\nexport const CMD_SET_REG = 0x2000\r\n\r\nexport const CMD_TOP_MASK = 0xf000\r\nexport const CMD_REG_MASK = 0x0fff\r\n\r\n\r\n// Commands 0x000-0x07f - common to all services\r\n// Commands 0x080-0xeff - defined per-service\r\n// Commands 0xf00-0xfff - reserved for implementation\r\n// enumeration data for CTRL, ad-data for other services\r\nexport const CMD_ADVERTISEMENT_DATA = 0x00\r\n// event from sensor or on broadcast service\r\nexport const CMD_EVENT = 0x01\r\n// request to calibrate sensor\r\nexport const CMD_CALIBRATE = 0x02\r\n// request human-readable description of service\r\nexport const CMD_GET_DESCRIPTION = 0x03\r\n\r\n// Commands specific to control service\r\n// do nothing\r\nexport const CMD_CTRL_NOOP = 0x80\r\n// blink led or otherwise draw user's attention\r\nexport const CMD_CTRL_IDENTIFY = 0x81\r\n// reset device\r\nexport const CMD_CTRL_RESET = 0x82\r\n\r\nexport const STREAM_PORT_SHIFT = 7\r\nexport const STREAM_COUNTER_MASK = 0x001f\r\nexport const STREAM_CLOSE_MASK = 0x0020\r\nexport const STREAM_METADATA_MASK = 0x0040\r\n\r\nexport const JD_SERIAL_HEADER_SIZE = 16\r\nexport const JD_SERIAL_MAX_PAYLOAD_SIZE = 236\r\nexport const JD_SERVICE_NUMBER_MASK = 0x3f\r\nexport const JD_SERVICE_NUMBER_INV_MASK = 0xc0\r\nexport const JD_SERVICE_NUMBER_CRC_ACK = 0x3f\r\nexport const JD_SERVICE_NUMBER_STREAM = 0x3e\r\nexport const JD_SERVICE_NUMBER_CTRL = 0x00\r\n\r\n// the COMMAND flag signifies that the device_identifier is the recipent\r\n// (i.e., it's a command for the peripheral); the bit clear means device_identifier is the source\r\n// (i.e., it's a report from peripheral or a broadcast message)\r\nexport const JD_FRAME_FLAG_COMMAND = 0x01\r\n// an ACK should be issued with CRC of this package upon reception\r\nexport const JD_FRAME_FLAG_ACK_REQUESTED = 0x02\r\n// the device_identifier contains target service class number\r\nexport const JD_FRAME_FLAG_IDENTIFIER_IS_SERVICE_CLASS = 0x04\r\n","export function error(msg: string) {\r\n    throw new Error(msg)\r\n}\r\n\r\nexport function log(msg: string, v?: any) {\r\n    if (v === undefined)\r\n        console.log(\"JD: \" + msg)\r\n    else\r\n        console.log(\"JD: \" + msg, v)\r\n}\r\n\r\nexport function warn(msg: string, v?: any) {\r\n    if (v === undefined)\r\n        console.log(\"JD-WARN: \" + msg)\r\n    else\r\n        console.log(\"JD-WARN: \" + msg, v)\r\n}\r\n\r\nexport function delay<T>(millis: number, value?: T): Promise<T> {\r\n    return new Promise((resolve) => setTimeout(() => resolve(value), millis))\r\n}\r\n\r\nexport function memcpy(trg: Uint8Array, trgOff: number, src: ArrayLike<number>, srcOff?: number, len?: number) {\r\n    if (srcOff === void 0)\r\n        srcOff = 0\r\n    if (len === void 0)\r\n        len = src.length - srcOff\r\n    for (let i = 0; i < len; ++i)\r\n        trg[trgOff + i] = src[srcOff + i]\r\n}\r\n\r\nexport function bufferEq(a: Uint8Array, b: ArrayLike<number>) {\r\n    if (a == b)\r\n        return true\r\n    if (!a || !b || a.length != b.length)\r\n        return false\r\n    for (let i = 0; i < a.length; ++i) {\r\n        if (a[i] != b[i]) return false\r\n    }\r\n    return true\r\n}\r\n\r\n\r\nexport function hash(buf: Uint8Array, bits: number) {\r\n    bits |= 0\r\n    if (bits < 1)\r\n        return 0\r\n    const h = fnv1(buf)\r\n    if (bits >= 32)\r\n        return h >>> 0\r\n    else\r\n        return ((h ^ (h >>> bits)) & ((1 << bits) - 1)) >>> 0\r\n}\r\n\r\nexport function idiv(a: number, b: number) { return ((a | 0) / (b | 0)) | 0 }\r\nexport function fnv1(data: Uint8Array) {\r\n    let h = 0x811c9dc5\r\n    for (let i = 0; i < data.length; ++i) {\r\n        h = Math.imul(h, 0x1000193) ^ data[i]\r\n    }\r\n    return h\r\n}\r\n\r\nexport function crc(p: Uint8Array) {\r\n    let crc = 0xffff;\r\n    for (let i = 0; i < p.length; ++i) {\r\n        const data = p[i];\r\n        let x = (crc >> 8) ^ data;\r\n        x ^= x >> 4;\r\n        crc = (crc << 8) ^ (x << 12) ^ (x << 5) ^ x;\r\n        crc &= 0xffff;\r\n    }\r\n    return crc;\r\n}\r\n\r\nexport function ALIGN(n: number) { return (n + 3) & ~3 }\r\n\r\n// this will take lower 8 bits from each character\r\nexport function stringToUint8Array(input: string) {\r\n    let len = input.length;\r\n    let res = new Uint8Array(len)\r\n    for (let i = 0; i < len; ++i)\r\n        res[i] = input.charCodeAt(i) & 0xff;\r\n    return res;\r\n}\r\n\r\nexport function uint8ArrayToString(input: ArrayLike<number>) {\r\n    let len = input.length;\r\n    let res = \"\"\r\n    for (let i = 0; i < len; ++i)\r\n        res += String.fromCharCode(input[i]);\r\n    return res;\r\n}\r\n\r\n\r\nexport function fromUTF8(binstr: string) {\r\n    if (!binstr) return \"\"\r\n\r\n    // escape function is deprecated\r\n    let escaped = \"\"\r\n    for (let i = 0; i < binstr.length; ++i) {\r\n        let k = binstr.charCodeAt(i) & 0xff\r\n        if (k == 37 || k > 0x7f) {\r\n            escaped += \"%\" + k.toString(16);\r\n        } else {\r\n            escaped += binstr.charAt(i)\r\n        }\r\n    }\r\n\r\n    // decodeURIComponent does the actual UTF8 decoding\r\n    return decodeURIComponent(escaped)\r\n}\r\n\r\nexport function toUTF8(str: string, cesu8?: boolean) {\r\n    let res = \"\";\r\n    if (!str) return res;\r\n    for (let i = 0; i < str.length; ++i) {\r\n        let code = str.charCodeAt(i);\r\n        if (code <= 0x7f) res += str.charAt(i);\r\n        else if (code <= 0x7ff) {\r\n            res += String.fromCharCode(0xc0 | (code >> 6), 0x80 | (code & 0x3f));\r\n        } else {\r\n            if (!cesu8 && 0xd800 <= code && code <= 0xdbff) {\r\n                let next = str.charCodeAt(++i);\r\n                if (!isNaN(next))\r\n                    code = 0x10000 + ((code - 0xd800) << 10) + (next - 0xdc00);\r\n            }\r\n\r\n            if (code <= 0xffff)\r\n                res += String.fromCharCode(0xe0 | (code >> 12), 0x80 | ((code >> 6) & 0x3f), 0x80 | (code & 0x3f));\r\n            else\r\n                res += String.fromCharCode(0xf0 | (code >> 18), 0x80 | ((code >> 12) & 0x3f), 0x80 | ((code >> 6) & 0x3f), 0x80 | (code & 0x3f));\r\n        }\r\n\r\n    }\r\n    return res;\r\n}\r\n\r\n\r\nexport interface SMap<T> {\r\n    [index: string]: T;\r\n}\r\n\r\nexport class PromiseBuffer<T> {\r\n    private waiting: ((v: (T | Error)) => void)[] = [];\r\n    private available: (T | Error)[] = [];\r\n\r\n    drain() {\r\n        for (let f of this.waiting) {\r\n            f(new Error(\"Promise Buffer Reset\"))\r\n        }\r\n        this.waiting = []\r\n        this.available = []\r\n    }\r\n\r\n\r\n    pushError(v: Error) {\r\n        this.push(v as any)\r\n    }\r\n\r\n    push(v: T) {\r\n        let f = this.waiting.shift()\r\n        if (f) f(v)\r\n        else this.available.push(v)\r\n    }\r\n\r\n    shiftAsync(timeout = 0) {\r\n        if (this.available.length > 0) {\r\n            let v = this.available.shift()\r\n            if (v instanceof Error)\r\n                return Promise.reject<T>(v)\r\n            else\r\n                return Promise.resolve<T>(v)\r\n        } else\r\n            return new Promise<T>((resolve, reject) => {\r\n                let f = (v: (T | Error)) => {\r\n                    if (v instanceof Error) reject(v)\r\n                    else resolve(v)\r\n                }\r\n                this.waiting.push(f)\r\n                if (timeout > 0) {\r\n                    delay(timeout)\r\n                        .then(() => {\r\n                            let idx = this.waiting.indexOf(f)\r\n                            if (idx >= 0) {\r\n                                this.waiting.splice(idx, 1)\r\n                                reject(new Error(\"Timeout\"))\r\n                            }\r\n                        })\r\n                }\r\n            })\r\n    }\r\n}\r\n\r\n\r\nexport class PromiseQueue {\r\n    promises: SMap<(() => Promise<any>)[]> = {};\r\n\r\n    enqueue<T>(id: string, f: () => Promise<T>): Promise<T> {\r\n        return new Promise<T>((resolve, reject) => {\r\n            let arr = this.promises[id]\r\n            if (!arr) {\r\n                arr = this.promises[id] = []\r\n            }\r\n            const cleanup = () => {\r\n                arr.shift()\r\n                if (arr.length == 0)\r\n                    delete this.promises[id]\r\n                else\r\n                    arr[0]()\r\n            }\r\n            arr.push(() =>\r\n                f().then(v => {\r\n                    cleanup()\r\n                    resolve(v)\r\n                }, err => {\r\n                    cleanup()\r\n                    reject(err)\r\n                }))\r\n            if (arr.length == 1)\r\n                arr[0]()\r\n        })\r\n    }\r\n}\r\n\r\nexport function toHex(bytes: ArrayLike<number>) {\r\n    let r = \"\"\r\n    for (let i = 0; i < bytes.length; ++i)\r\n        r += (\"0\" + bytes[i].toString(16)).slice(-2)\r\n    return r\r\n}\r\n\r\nexport function fromHex(hex: string) {\r\n    let r = new Uint8Array(hex.length >> 1)\r\n    for (let i = 0; i < hex.length; i += 2)\r\n        r[i >> 1] = parseInt(hex.slice(i, i + 2), 16)\r\n    return r\r\n}\r\n\r\nexport interface MutableArrayLike<T> {\r\n    readonly length: number;\r\n    [n: number]: T;\r\n}\r\n\r\nexport function write32(buf: MutableArrayLike<number>, pos: number, v: number) {\r\n    buf[pos + 0] = (v >> 0) & 0xff;\r\n    buf[pos + 1] = (v >> 8) & 0xff;\r\n    buf[pos + 2] = (v >> 16) & 0xff;\r\n    buf[pos + 3] = (v >> 24) & 0xff;\r\n}\r\n\r\nexport function write16(buf: MutableArrayLike<number>, pos: number, v: number) {\r\n    buf[pos + 0] = (v >> 0) & 0xff;\r\n    buf[pos + 1] = (v >> 8) & 0xff;\r\n}\r\n\r\nexport function read32(buf: ArrayLike<number>, pos: number) {\r\n    return (buf[pos] | (buf[pos + 1] << 8) | (buf[pos + 2] << 16) | (buf[pos + 3] << 24)) >>> 0\r\n}\r\n\r\nexport function read16(buf: ArrayLike<number>, pos: number) {\r\n    return buf[pos] | (buf[pos + 1] << 8)\r\n}\r\n\r\nexport function encodeU32LE(words: number[]) {\r\n    let r = new Uint8Array(words.length * 4)\r\n    for (let i = 0; i < words.length; ++i)\r\n        write32(r, i * 4, words[i])\r\n    return r\r\n}\r\n\r\nexport function decodeU32LE(buf: Uint8Array) {\r\n    let res: number[] = []\r\n    for (let i = 0; i < buf.length; i += 4)\r\n        res.push(read32(buf, i))\r\n    return res\r\n}\r\n\r\nexport const enum NumberFormat {\r\n    Int8LE = 1,\r\n    UInt8LE = 2,\r\n    Int16LE = 3,\r\n    UInt16LE = 4,\r\n    Int32LE = 5,\r\n    Int8BE = 6,\r\n    UInt8BE = 7,\r\n    Int16BE = 8,\r\n    UInt16BE = 9,\r\n    Int32BE = 10,\r\n    UInt32LE = 11,\r\n    UInt32BE = 12,\r\n    Float32LE = 13,\r\n    Float64LE = 14,\r\n    Float32BE = 15,\r\n    Float64BE = 16,\r\n}\r\n\r\nexport function getNumber(buf: ArrayLike<number>, fmt: NumberFormat, offset: number) {\r\n    switch (fmt) {\r\n        case NumberFormat.UInt8BE:\r\n        case NumberFormat.UInt8LE:\r\n            return buf[offset]\r\n        case NumberFormat.Int8BE:\r\n        case NumberFormat.Int8LE:\r\n            return (buf[offset] << 24) >> 24\r\n        case NumberFormat.UInt16LE:\r\n            return read16(buf, offset)\r\n        case NumberFormat.Int16LE:\r\n            return (read16(buf, offset) << 16) >> 16\r\n        case NumberFormat.UInt32LE:\r\n            return read32(buf, offset)\r\n        case NumberFormat.Int32LE:\r\n            return read32(buf, offset) >> 0\r\n        default:\r\n            throw new Error(\"unsupported fmt:\" + fmt)\r\n    }\r\n}\r\n\r\nexport function bufferToString(buf: Uint8Array) {\r\n    return fromUTF8(uint8ArrayToString(buf))\r\n}\r\n\r\nexport function bufferConcat(a: Uint8Array, b: Uint8Array) {\r\n    const r = new Uint8Array(a.length + b.length)\r\n    r.set(a, 0)\r\n    r.set(b, a.length)\r\n    return r\r\n}\r\n\r\nexport function jsonCopyFrom<T>(trg: T, src: T) {\r\n    let v = clone(src)\r\n    for (let k of Object.keys(src)) {\r\n        (trg as any)[k] = (v as any)[k]\r\n    }\r\n}\r\nexport function assert(cond: boolean, msg = \"Assertion failed\") {\r\n    if (!cond) {\r\n        debugger\r\n        throw new Error(msg)\r\n    }\r\n}\r\n\r\nexport function flatClone<T extends Object>(obj: T): T {\r\n    if (obj == null) return null\r\n    let r: any = {}\r\n    Object.keys(obj).forEach((k) => { r[k] = (obj as any)[k] })\r\n    return r;\r\n}\r\n\r\nexport function clone<T>(v: T): T {\r\n    if (v == null) return null\r\n    return JSON.parse(JSON.stringify(v))\r\n}\r\n\r\n","import { Packet } from \"./packet\"\r\nimport { getDevice } from \"./device\"\r\nimport { bufferEq } from \"./utils\"\r\nimport { JD_SERVICE_NUMBER_CTRL, CMD_ADVERTISEMENT_DATA } from \"./constants\";\r\n\r\n/**\r\n * A transport layer for the jacdac packets\r\n */\r\nexport interface Bus {\r\n    send: (p: Packet) => Promise<void>;\r\n}\r\n\r\nlet _bus: Bus;\r\n\r\n/**\r\n * Register transport layer function that sends packet.\r\n * @param f transport function sending packet.\r\n */\r\nexport function setBus(bus: Bus) {\r\n    _bus = bus;\r\n}\r\n\r\n/**\r\n * Sends a packet over the bus\r\n * @param p \r\n */\r\nexport function sendPacket(p: Packet): Promise<void> {\r\n    return _bus ? _bus.send(p) : Promise.resolve();\r\n}\r\n","import { warn, crc, ALIGN, write16, bufferConcat, toHex, fromHex, error, read32, read16, NumberFormat, getNumber, write32 } from \"./utils\";\r\nimport {\r\n    JD_FRAME_FLAG_COMMAND,\r\n    JD_FRAME_FLAG_IDENTIFIER_IS_SERVICE_CLASS,\r\n    CMD_SET_REG,\r\n    JD_SERIAL_HEADER_SIZE,\r\n    JD_FRAME_FLAG_ACK_REQUESTED,\r\n    JD_SERVICE_NUMBER_MASK,\r\n    JD_SERVICE_NUMBER_INV_MASK,\r\n    JD_SERIAL_MAX_PAYLOAD_SIZE,\r\n} from \"./constants\";\r\nimport {\r\n    sendPacket\r\n} from \"./bus\";\r\nimport { Device } from \"./device\";\r\n\r\nexport class Packet {\r\n    _header: Uint8Array;\r\n    _data: Uint8Array;\r\n    timestamp: number\r\n    dev: Device\r\n\r\n    private constructor() { }\r\n\r\n    static fromBinary(buf: Uint8Array) {\r\n        const p = new Packet()\r\n        p._header = buf.slice(0, JD_SERIAL_HEADER_SIZE)\r\n        p._data = buf.slice(JD_SERIAL_HEADER_SIZE)\r\n        return p\r\n    }\r\n\r\n    static from(service_command: number, data: Uint8Array) {\r\n        const p = new Packet()\r\n        p._header = new Uint8Array(JD_SERIAL_HEADER_SIZE)\r\n        p.data = data\r\n        p.service_command = service_command\r\n        return p\r\n    }\r\n\r\n    static onlyHeader(service_command: number) {\r\n        return Packet.from(service_command, new Uint8Array(0))\r\n    }\r\n\r\n    toBuffer() {\r\n        return bufferConcat(this._header, this._data)\r\n    }\r\n\r\n    get device_identifier() {\r\n        return toHex(this._header.slice(4, 4 + 8))\r\n    }\r\n    set device_identifier(id: string) {\r\n        const idb = fromHex(id)\r\n        if (idb.length != 8)\r\n            error(\"Invalid id\")\r\n        this._header.set(idb, 4)\r\n    }\r\n\r\n    get frame_flags() { return this._header[3] }\r\n\r\n    get multicommand_class() {\r\n        if (this.frame_flags & JD_FRAME_FLAG_IDENTIFIER_IS_SERVICE_CLASS)\r\n            return read32(this._header, 4)\r\n        return undefined\r\n    }\r\n\r\n    get size(): number {\r\n        return this._header[12];\r\n    }\r\n\r\n    get requires_ack(): boolean {\r\n        return (this.frame_flags & JD_FRAME_FLAG_ACK_REQUESTED) ? true : false;\r\n    }\r\n    set requires_ack(ack: boolean) {\r\n        if (ack != this.requires_ack)\r\n            this._header[3] ^= JD_FRAME_FLAG_ACK_REQUESTED\r\n    }\r\n\r\n    get service_number(): number {\r\n        return this._header[13] & JD_SERVICE_NUMBER_MASK;\r\n    }\r\n    set service_number(service_number: number) {\r\n        if (service_number == null)\r\n            throw new Error(\"service_number not set\")\r\n        this._header[13] = (this._header[13] & JD_SERVICE_NUMBER_INV_MASK) | service_number;\r\n    }\r\n\r\n    get service_class(): number {\r\n        if (this.dev)\r\n            return this.dev.serviceAt(this.service_number)\r\n        return undefined\r\n    }\r\n\r\n    get crc(): number {\r\n        return read16(this._header, 0)\r\n    }\r\n\r\n    get service_command(): number {\r\n        return read16(this._header, 14)\r\n    }\r\n    set service_command(cmd: number) {\r\n        write16(this._header, 14, cmd)\r\n    }\r\n\r\n    get is_reg_set() {\r\n        return (this.service_command >> 12) == (CMD_SET_REG >> 12)\r\n    }\r\n\r\n    get is_reg_get() {\r\n        return (this.service_command >> 12) == (CMD_SET_REG >> 12)\r\n    }\r\n\r\n    get data(): Uint8Array {\r\n        return this._data\r\n    }\r\n\r\n    set data(buf: Uint8Array) {\r\n        if (buf.length > JD_SERIAL_MAX_PAYLOAD_SIZE)\r\n            throw Error(\"Too big\")\r\n        this._header[12] = buf.length\r\n        this._data = buf\r\n    }\r\n\r\n    get uintData() {\r\n        let buf = this._data\r\n        if (buf.length == 0)\r\n            return undefined\r\n        if (buf.length < 4)\r\n            buf = bufferConcat(buf, new Uint8Array(4))\r\n        return read32(buf, 0)\r\n    }\r\n\r\n    get intData() {\r\n        let fmt: NumberFormat\r\n        switch (this._data.length) {\r\n            case 0:\r\n                return undefined\r\n            case 1:\r\n                fmt = NumberFormat.Int8LE\r\n                break\r\n            case 2:\r\n            case 3:\r\n                fmt = NumberFormat.Int16LE\r\n                break\r\n            default:\r\n                fmt = NumberFormat.Int32LE\r\n                break\r\n        }\r\n        return this.getNumber(fmt, 0)\r\n    }\r\n\r\n    compress(stripped: Uint8Array[]) {\r\n        if (stripped.length == 0)\r\n            return\r\n        let sz = -4\r\n        for (let s of stripped) {\r\n            sz += s.length\r\n        }\r\n        const data = new Uint8Array(sz)\r\n        this._header.set(stripped[0], 12)\r\n        data.set(stripped[0].slice(4), 0)\r\n        sz = stripped[0].length - 4\r\n        for (let s of stripped.slice(1)) {\r\n            data.set(s, sz)\r\n            sz += s.length\r\n        }\r\n        this._data = data\r\n    }\r\n\r\n    withFrameStripped() {\r\n        return bufferConcat(this._header.slice(12, 12 + 4), this._data)\r\n    }\r\n\r\n    getNumber(fmt: NumberFormat, offset: number) {\r\n        return getNumber(this._data, fmt, offset)\r\n    }\r\n\r\n    get is_command() {\r\n        return !!(this.frame_flags & JD_FRAME_FLAG_COMMAND)\r\n    }\r\n\r\n    get is_report() {\r\n        return !this.is_command\r\n    }\r\n\r\n    toString(): string {\r\n        let msg = `${this.device_identifier}/${this.service_number}[${this.frame_flags}]: ${this.service_command} sz=${this.size}`\r\n        if (this.size < 20) msg += \": \" + toHex(this.data)\r\n        else msg += \": \" + toHex(this.data.slice(0, 20)) + \"...\"\r\n        return msg\r\n    }\r\n\r\n    sendCoreAsync() {\r\n        this._header[2] = this.size + 4\r\n        write16(this._header, 0, crc(bufferConcat(this._header.slice(2), this._data)))\r\n        return sendPacket(this)\r\n    }\r\n\r\n    sendReportAsync(dev: Device) {\r\n        if (!dev)\r\n            return Promise.resolve()\r\n        this.device_identifier = dev.deviceId\r\n        return this.sendCoreAsync()\r\n    }\r\n\r\n    sendCmdAsync(dev: Device) {\r\n        if (!dev)\r\n            return Promise.resolve()\r\n        this.device_identifier = dev.deviceId\r\n        this._header[3] |= JD_FRAME_FLAG_COMMAND\r\n        return this.sendCoreAsync()\r\n    }\r\n\r\n    sendAsMultiCommandAsync(service_class: number) {\r\n        this._header[3] |= JD_FRAME_FLAG_IDENTIFIER_IS_SERVICE_CLASS | JD_FRAME_FLAG_COMMAND\r\n        write32(this._header, 4, service_class)\r\n        write32(this._header, 8, 0)\r\n        return this.sendCoreAsync()\r\n    }\r\n\r\n    static fromFrame(frame: Uint8Array, timestamp: number) {\r\n        return frameToPackets(frame, timestamp)\r\n    }\r\n}\r\n\r\n\r\nfunction frameToPackets(frame: Uint8Array, timestamp: number) {\r\n    const size = frame[2] || 0\r\n    if (frame.length < size + 12) {\r\n        warn(`${timestamp}ms: got only ${frame.length} bytes; expecting ${size + 12}`)\r\n    } else if (size < 4) {\r\n        warn(`${timestamp}ms: empty packet`)\r\n    } else {\r\n        const computed = crc(frame.slice(2, size + 12))\r\n        const actual = read16(frame, 0)\r\n        if (actual != computed)\r\n            console.log(`crc mismatch; sz=${size} got:${actual}, exp:${computed}`)\r\n\r\n        const res: Packet[] = []\r\n        if (frame.length != 12 + frame[2])\r\n            warn(`${timestamp}ms: unexpected packet len: ${frame.length}`)\r\n        for (let ptr = 12; ptr < 12 + frame[2];) {\r\n            const psz = frame[ptr] + 4\r\n            const sz = ALIGN(psz)\r\n            const pkt = bufferConcat(frame.slice(0, 12), frame.slice(ptr, ptr + psz))\r\n            if (ptr + sz > 12 + frame[2])\r\n                warn(`${timestamp}ms: invalid frame compression, res len=${res.length}`)\r\n            const p = Packet.fromBinary(pkt)\r\n            p.timestamp = timestamp\r\n            res.push(p)\r\n            ptr += sz\r\n        }\r\n\r\n        return res\r\n    }\r\n\r\n    return []\r\n}","import { Packet } from \"./packet\"\r\nimport { JD_SERVICE_NUMBER_CTRL, CMD_ADVERTISEMENT_DATA } from \"./constants\"\r\nimport { hash, fromHex, idiv, getNumber, NumberFormat, read32, SMap, bufferEq } from \"./utils\"\r\n\r\nconst devices_: Device[] = []\r\nexport const deviceNames: SMap<string> = {}\r\n\r\n/**\r\n * Gets the current list of known devices on the bus\r\n */\r\nexport function getDevices() { return devices_.slice() }\r\n\r\n/**\r\n * Gets a device on the bus\r\n * @param id \r\n */\r\nexport function getDevice(id: string) {\r\n    let d = devices_.find(d => d.deviceId == id)\r\n    if (!d)\r\n        d = new Device(id)\r\n    return d\r\n}\r\n\r\nexport class Device {\r\n    services: Uint8Array\r\n    lastSeen: number\r\n    lastServiceUpdate: number\r\n    currentReading: Uint8Array\r\n    private _shortId: string\r\n\r\n    constructor(public deviceId: string) {\r\n        devices_.push(this)\r\n    }\r\n\r\n    get name() {\r\n        return deviceNames[this.deviceId] || deviceNames[this.shortId]\r\n    }\r\n\r\n    get shortId() {\r\n        // TODO measure if caching is worth it\r\n        if (!this._shortId)\r\n            this._shortId = shortDeviceId(this.deviceId)\r\n        return this._shortId;\r\n    }\r\n\r\n    toString() {\r\n        return this.shortId + (this.name ? ` (${this.name})` : ``)\r\n    }\r\n\r\n    hasService(service_class: number) {\r\n        for (let i = 4; i < this.services.length; i += 4)\r\n            if (getNumber(this.services, NumberFormat.UInt32LE, i) == service_class)\r\n                return true\r\n        return false\r\n    }\r\n\r\n    serviceAt(idx: number) {\r\n        idx <<= 2\r\n        if (!this.services || idx + 4 > this.services.length)\r\n            return undefined\r\n        return read32(this.services, idx)\r\n    }\r\n\r\n    sendCtrlCommand(cmd: number, payload: Buffer = null) {\r\n        const pkt = !payload ? Packet.onlyHeader(cmd) : Packet.from(cmd, payload)\r\n        pkt.service_number = JD_SERVICE_NUMBER_CTRL\r\n        pkt.sendCmdAsync(this)\r\n    }\r\n}\r\n\r\n\r\n// 4 letter ID; 0.04%/0.01%/0.002% collision probability among 20/10/5 devices\r\n// 3 letter ID; 1.1%/2.6%/0.05%\r\n// 2 letter ID; 25%/6.4%/1.5%\r\nexport function shortDeviceId(devid: string) {\r\n    const h = hash(fromHex(devid), 30)\r\n    return String.fromCharCode(0x41 + h % 26) +\r\n        String.fromCharCode(0x41 + idiv(h, 26) % 26) +\r\n        String.fromCharCode(0x41 + idiv(h, 26 * 26) % 26) +\r\n        String.fromCharCode(0x41 + idiv(h, 26 * 26 * 26) % 26)\r\n}\r\n\r\n\r\n/**\r\n * Ingests and process a packet received from the bus.\r\n * @param pkt a jacdac packet\r\n */\r\nexport function processPacket(pkt: Packet) {\r\n    if (pkt.multicommand_class) {\r\n        //\r\n    } else if (pkt.is_command) {\r\n        pkt.dev = getDevice(pkt.device_identifier)\r\n    } else {\r\n        const dev = pkt.dev = getDevice(pkt.device_identifier)\r\n        dev.lastSeen = pkt.timestamp\r\n\r\n        if (pkt.service_number == JD_SERVICE_NUMBER_CTRL) {\r\n            if (pkt.service_command == CMD_ADVERTISEMENT_DATA) {\r\n                if (!bufferEq(pkt.data, dev.services)) {\r\n                    dev.services = pkt.data\r\n                    dev.lastServiceUpdate = pkt.timestamp\r\n                    // reattach(dev)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import * as U from \"./utils\"\r\n\r\nconst controlTransferGetReport = 0x01;\r\nconst controlTransferSetReport = 0x09;\r\nconst controlTransferOutReport = 0x200;\r\nconst controlTransferInReport = 0x100;\r\n\r\n// see https://github.com/microsoft/uf2/blob/master/hf2.md for full spec\r\nexport const HF2_CMD_BININFO = 0x0001 // no arguments\r\nexport const HF2_MODE_BOOTLOADER = 0x01\r\nexport const HF2_MODE_USERSPACE = 0x02\r\n/*\r\nstruct HF2_BININFO_Result {\r\n    uint32_t mode;\r\n    uint32_t flash_page_size;\r\n    uint32_t flash_num_pages;\r\n    uint32_t max_message_size;\r\n};\r\n*/\r\n\r\nexport const HF2_CMD_INFO = 0x0002\r\n// no arguments\r\n// results is utf8 character array\r\n\r\nexport const HF2_CMD_RESET_INTO_APP = 0x0003// no arguments, no result\r\n\r\nexport const HF2_CMD_RESET_INTO_BOOTLOADER = 0x0004  // no arguments, no result\r\n\r\nexport const HF2_CMD_START_FLASH = 0x0005   // no arguments, no result\r\n\r\nexport const HF2_CMD_WRITE_FLASH_PAGE = 0x0006\r\n/*\r\nstruct HF2_WRITE_FLASH_PAGE_Command {\r\n    uint32_t target_addr;\r\n    uint32_t data[flash_page_size];\r\n};\r\n*/\r\n// no result\r\n\r\nexport const HF2_CMD_CHKSUM_PAGES = 0x0007\r\n/*\r\nstruct HF2_CHKSUM_PAGES_Command {\r\n    uint32_t target_addr;\r\n    uint32_t num_pages;\r\n};\r\nstruct HF2_CHKSUM_PAGES_Result {\r\n    uint16_t chksums[num_pages];\r\n};\r\n*/\r\n\r\nexport const HF2_CMD_READ_WORDS = 0x0008\r\n/*\r\nstruct HF2_READ_WORDS_Command {\r\n    uint32_t target_addr;\r\n    uint32_t num_words;\r\n};\r\nstruct HF2_READ_WORDS_Result {\r\n    uint32_t words[num_words];\r\n};\r\n*/\r\n\r\nexport const HF2_CMD_WRITE_WORDS = 0x0009\r\n/*\r\nstruct HF2_WRITE_WORDS_Command {\r\n    uint32_t target_addr;\r\n    uint32_t num_words;\r\n    uint32_t words[num_words];\r\n};\r\n*/\r\n// no result\r\n\r\nexport const HF2_CMD_DMESG = 0x0010\r\n// no arguments\r\n// results is utf8 character array\r\n\r\nexport const HF2_FLAG_SERIAL_OUT = 0x80\r\nexport const HF2_FLAG_SERIAL_ERR = 0xC0\r\nexport const HF2_FLAG_CMDPKT_LAST = 0x40\r\nexport const HF2_FLAG_CMDPKT_BODY = 0x00\r\nexport const HF2_FLAG_MASK = 0xC0\r\nexport const HF2_SIZE_MASK = 63\r\n\r\nexport const HF2_STATUS_OK = 0x00\r\nexport const HF2_STATUS_INVALID_CMD = 0x01\r\nexport const HF2_STATUS_EXEC_ERR = 0x02\r\nexport const HF2_STATUS_EVENT = 0x80\r\n\r\n// the eventId is overlayed on the tag+status; the mask corresponds\r\n// to the HF2_STATUS_EVENT above\r\nexport const HF2_EV_MASK = 0x800000\r\n\r\nexport const HF2_CMD_JDS_CONFIG = 0x0020\r\nexport const HF2_CMD_JDS_SEND = 0x0021\r\nexport const HF2_EV_JDS_PACKET = 0x800020\r\n\r\n\r\nexport class Transport {\r\n    dev: USBDevice;\r\n    iface: USBInterface;\r\n    altIface: USBAlternateInterface;\r\n    epIn: USBEndpoint;\r\n    epOut: USBEndpoint;\r\n    readLoopStarted = false;\r\n    ready = false;\r\n\r\n    constructor(private requestDevice: (options: USBDeviceRequestOptions) => Promise<USBDevice>) {\r\n\r\n    }\r\n\r\n    onData = (v: Uint8Array) => { };\r\n    onError = (e: Error) => {\r\n        console.error(\"HF2 error: \" + (e ? e.stack : e))\r\n    };\r\n\r\n    log(msg: string, v?: any) {\r\n        if (v != undefined)\r\n            console.log(\"HF2: \" + msg, v)\r\n        else\r\n            console.log(\"HF2: \" + msg)\r\n    }\r\n\r\n\r\n    private clearDev() {\r\n        if (this.dev) {\r\n            this.dev = null\r\n            this.epIn = null\r\n            this.epOut = null\r\n        }\r\n    }\r\n\r\n    disconnectAsync() {\r\n        this.ready = false\r\n        if (!this.dev) return Promise.resolve()\r\n        this.log(\"close device\")\r\n        return this.dev.close()\r\n            .catch(e => {\r\n                // just ignore errors closing, most likely device just disconnected\r\n            })\r\n            .then(() => {\r\n                this.clearDev()\r\n                return U.delay(500)\r\n            })\r\n    }\r\n\r\n    private recvPacketAsync(): Promise<Uint8Array> {\r\n        let final = (res: USBInTransferResult) => {\r\n            if (res.status != \"ok\")\r\n                this.error(\"USB IN transfer failed\")\r\n            let arr = new Uint8Array(res.data.buffer)\r\n            if (arr.length == 0)\r\n                return this.recvPacketAsync()\r\n            return arr\r\n        }\r\n\r\n        if (!this.dev)\r\n            return Promise.reject(new Error(\"Disconnected\"))\r\n\r\n        if (!this.epIn) {\r\n            return this.dev.controlTransferIn({\r\n                requestType: \"class\",\r\n                recipient: \"interface\",\r\n                request: controlTransferGetReport,\r\n                value: controlTransferInReport,\r\n                index: this.iface.interfaceNumber\r\n            }, 64).then(final)\r\n        }\r\n\r\n        return this.dev.transferIn(this.epIn.endpointNumber, 64)\r\n            .then(final)\r\n    }\r\n\r\n    error(msg: string) {\r\n        throw new Error(`USB error on device ${this.dev ? this.dev.productName : \"n/a\"} (${msg})`)\r\n    }\r\n\r\n    private async readLoop() {\r\n        if (this.readLoopStarted)\r\n            return\r\n        this.readLoopStarted = true\r\n        this.log(\"start read loop\")\r\n\r\n        while (true) {\r\n            if (!this.ready) {\r\n                break\r\n                //await U.delay(300)\r\n                //continue\r\n            }\r\n\r\n            try {\r\n                const buf = await this.recvPacketAsync()\r\n\r\n                if (buf[0]) {\r\n                    // we've got data; retry reading immedietly after processing it\r\n                    this.onData(buf)\r\n                } else {\r\n                    // throttle down if no data coming\r\n                    await U.delay(5)\r\n                }\r\n            } catch (err) {\r\n                if (this.dev)\r\n                    this.onError(err)\r\n                await U.delay(300)\r\n            }\r\n        }\r\n    }\r\n\r\n    sendPacketAsync(pkt: Uint8Array) {\r\n        if (!this.dev)\r\n            return Promise.reject(new Error(\"Disconnected\"))\r\n        U.assert(pkt.length <= 64)\r\n        if (!this.epOut) {\r\n            return this.dev.controlTransferOut({\r\n                requestType: \"class\",\r\n                recipient: \"interface\",\r\n                request: controlTransferSetReport,\r\n                value: controlTransferOutReport,\r\n                index: this.iface.interfaceNumber\r\n            }, pkt).then(res => {\r\n                if (res.status != \"ok\")\r\n                    this.error(\"USB CTRL OUT transfer failed\")\r\n            })\r\n        }\r\n        return this.dev.transferOut(this.epOut.endpointNumber, pkt)\r\n            .then(res => {\r\n                if (res.status != \"ok\")\r\n                    this.error(\"USB OUT transfer failed\")\r\n            })\r\n    }\r\n\r\n\r\n    async init() {\r\n        this.dev = await this.requestDevice({ filters: [{}] })\r\n        this.iface = undefined;\r\n        this.altIface = undefined;\r\n        this.log(\"connect device: \" + this.dev.manufacturerName + \" \" + this.dev.productName)\r\n\r\n        // resolve interfaces\r\n        if (this.dev.deviceVersionMajor == 42) {\r\n            for (const iface of this.dev.configuration.interfaces) {\r\n                const alt = iface.alternates[0]\r\n                if (alt.interfaceClass == 0xff && alt.interfaceSubclass == 42) {\r\n                    this.iface = iface;\r\n                    this.altIface = alt;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.iface) throw new Error(\"HF2 interface not found\")\r\n\r\n        await this.dev.open()\r\n        await this.dev.selectConfiguration(1)\r\n\r\n        if (this.altIface.endpoints.length) {\r\n            this.epIn = this.altIface.endpoints.filter(e => e.direction == \"in\")[0]\r\n            this.epOut = this.altIface.endpoints.filter(e => e.direction == \"out\")[0]\r\n            U.assert(this.epIn.packetSize == 64);\r\n            U.assert(this.epOut.packetSize == 64);\r\n        }\r\n        this.log(\"claim interface\")\r\n        await this.dev.claimInterface(this.iface.interfaceNumber)\r\n        this.log(\"all connected\")\r\n        this.ready = true\r\n        this.readLoop()\r\n    }\r\n}\r\n\r\nexport class Proto {\r\n    eventHandlers: U.SMap<(buf: Uint8Array) => void> = {}\r\n    msgs = new U.PromiseBuffer<Uint8Array>()\r\n    cmdSeq = (Math.random() * 0xffff) | 0;\r\n    private lock = new U.PromiseQueue();\r\n\r\n    constructor(public io: Transport) {\r\n        let frames: Uint8Array[] = []\r\n\r\n        io.onData = buf => {\r\n            let tp = buf[0] & HF2_FLAG_MASK\r\n            let len = buf[0] & 63\r\n            //console.log(`msg tp=${tp} len=${len}`)\r\n            let frame = new Uint8Array(len)\r\n            U.memcpy(frame, 0, buf, 1, len)\r\n            if (tp & HF2_FLAG_SERIAL_OUT) {\r\n                this.onSerial(frame, tp == HF2_FLAG_SERIAL_ERR)\r\n                return\r\n            }\r\n            frames.push(frame)\r\n            if (tp == HF2_FLAG_CMDPKT_BODY) {\r\n                return\r\n            } else {\r\n                U.assert(tp == HF2_FLAG_CMDPKT_LAST)\r\n                let total = 0\r\n                for (let f of frames) total += f.length\r\n                let r = new Uint8Array(total)\r\n                let ptr = 0\r\n                for (let f of frames) {\r\n                    U.memcpy(r, ptr, f)\r\n                    ptr += f.length\r\n                }\r\n                frames = []\r\n                if (r[2] & HF2_STATUS_EVENT) {\r\n                    // asynchronous event\r\n                    this.handleEvent(r)\r\n                } else {\r\n                    this.msgs.push(r)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    error(m: string) {\r\n        return this.io.error(m)\r\n    }\r\n\r\n    talkAsync(cmd: number, data?: Uint8Array) {\r\n        let len = 8\r\n        if (data) len += data.length\r\n        let pkt = new Uint8Array(len)\r\n        let seq = ++this.cmdSeq & 0xffff\r\n        U.write32(pkt, 0, cmd);\r\n        U.write16(pkt, 4, seq);\r\n        U.write16(pkt, 6, 0);\r\n        if (data)\r\n            U.memcpy(pkt, 8, data, 0, data.length)\r\n        let numSkipped = 0\r\n        let handleReturnAsync = (): Promise<Uint8Array> =>\r\n            this.msgs.shiftAsync(1000) // we wait up to a second\r\n                .then(res => {\r\n                    if (U.read16(res, 0) != seq) {\r\n                        if (numSkipped < 3) {\r\n                            numSkipped++\r\n                            this.io.log(`message out of sync, (${seq} vs ${U.read16(res, 0)}); will re-try`)\r\n                            return handleReturnAsync()\r\n                        }\r\n                        this.error(\"out of sync\")\r\n                    }\r\n                    let info = \"\"\r\n                    if (res[3])\r\n                        info = \"; info=\" + res[3]\r\n                    switch (res[2]) {\r\n                        case HF2_STATUS_OK:\r\n                            return res.slice(4)\r\n                        case HF2_STATUS_INVALID_CMD:\r\n                            this.error(\"invalid command\" + info)\r\n                            break\r\n                        case HF2_STATUS_EXEC_ERR:\r\n                            this.error(\"execution error\" + info)\r\n                            break\r\n                        default:\r\n                            this.error(\"error \" + res[2] + info)\r\n                            break\r\n                    }\r\n                    return null\r\n                })\r\n\r\n        return this.lock.enqueue(\"talk\", () =>\r\n            this.sendMsgAsync(pkt)\r\n                .then(handleReturnAsync))\r\n    }\r\n\r\n\r\n    private sendMsgAsync(buf: Uint8Array, serial: number = 0) {\r\n        // Util.assert(buf.length <= this.maxMsgSize)\r\n        let frame = new Uint8Array(64)\r\n        let loop = (pos: number): Promise<void> => {\r\n            let len = buf.length - pos\r\n            if (len <= 0) return Promise.resolve()\r\n            if (len > 63) {\r\n                len = 63\r\n                frame[0] = HF2_FLAG_CMDPKT_BODY;\r\n            } else {\r\n                frame[0] = HF2_FLAG_CMDPKT_LAST;\r\n            }\r\n            if (serial) frame[0] = serial == 1 ? HF2_FLAG_SERIAL_OUT : HF2_FLAG_SERIAL_ERR;\r\n            frame[0] |= len;\r\n            for (let i = 0; i < len; ++i)\r\n                frame[i + 1] = buf[pos + i]\r\n            return this.io.sendPacketAsync(frame)\r\n                .then(() => loop(pos + len))\r\n        }\r\n        return loop(0)\r\n    }\r\n\r\n    onEvent(id: number, f: (buf: Uint8Array) => void) {\r\n        U.assert(!!(id & HF2_EV_MASK))\r\n        this.eventHandlers[id + \"\"] = f\r\n    }\r\n\r\n    onJDMessage(f: (buf: Uint8Array) => void) {\r\n        this.talkAsync(HF2_CMD_JDS_CONFIG, U.encodeU32LE([1]))\r\n        this.onEvent(HF2_EV_JDS_PACKET, f)\r\n    }\r\n\r\n    sendJDMessageAsync(buf: Uint8Array) {\r\n        return this.talkAsync(HF2_CMD_JDS_SEND, buf)\r\n    }\r\n\r\n    handleEvent(buf: Uint8Array) {\r\n        let evid = U.read32(buf, 0)\r\n        let f = this.eventHandlers[evid + \"\"]\r\n        if (f) {\r\n            f(buf.slice(4))\r\n        } else {\r\n            this.io.log(\"unhandled event: \" + evid.toString(16))\r\n        }\r\n    }\r\n    onSerial(data: Uint8Array, iserr: boolean) {\r\n        console.log(\"SERIAL:\", U.bufferToString(data))\r\n    }\r\n\r\n    async init() {\r\n        await this.io.init()\r\n        const buf = await this.talkAsync(HF2_CMD_INFO)\r\n        this.io.log(\"Connected to: \" + U.bufferToString(buf))\r\n    }\r\n}\r\n","import * as U from \"./utils\"\r\nimport * as jd from \"./constants\"\r\nimport { Packet } from \"./packet\"\r\n\r\nconst service_classes: U.SMap<number> = {\r\n    \"<disabled>\": -1,\r\n    CTRL: 0,\r\n    LOGGER: 0x12dc1fca,\r\n    BATTERY: 0x1d2a2acd,\r\n    ACCELEROMETER: 0x1f140409,\r\n    BUTTON: 0x1473a263,\r\n    TOUCHBUTTON: 0x130cf5be,\r\n    LIGHT_SENSOR: 0x15e7a0ff,\r\n    MICROPHONE: 0x1a5c5866,\r\n    THERMOMETER: 0x1421bac7,\r\n    SWITCH: 0x14218172,\r\n    PIXEL: 0x1768fbbf,\r\n    HAPTIC: 0x116b14a3,\r\n    LIGHT: 0x126f00e0,\r\n    KEYBOARD: 0x1ae4812d,\r\n    MOUSE: 0x14bc97bf,\r\n    GAMEPAD: 0x100527e8,\r\n    MUSIC: 0x1b57b1d7,\r\n    SERVO: 0x12fc9103,\r\n    CONTROLLER: 0x188ae4b8,\r\n    LCD: 0x18d5284c,\r\n    MESSAGE_BUS: 0x115cabf5,\r\n    COLOR_SENSOR: 0x14d6dda2,\r\n    LIGHT_SPECTRUM_SENSOR: 0x16fa0c0d,\r\n    PROXIMITY: 0x14c1791b,\r\n    TOUCH_BUTTONS: 0x1acb49d5,\r\n    SERVOS: 0x182988d8,\r\n    ROTARY_ENCODER: 0x10fa29c9,\r\n    DNS: 0x117729bd,\r\n    PWM_LIGHT: 0x1fb57453,\r\n    BOOTLOADER: 0x1ffa9948,\r\n    ARCADE_CONTROLS: 0x1deaa06e,\r\n    POWER: 0x1fa4c95a,\r\n    SLIDER: 0x1f274746,\r\n    MOTOR: 0x17004cd8,\r\n    TCP: 0x1b43b70b,\r\n    WIFI: 0x18aae1fa,\r\n}\r\n\r\nconst generic_commands: U.SMap<number> = {\r\n    CMD_ADVERTISEMENT_DATA: 0x00,\r\n    CMD_EVENT: 0x01,\r\n    CMD_CALIBRATE: 0x02,\r\n    CMD_GET_DESCRIPTION: 0x03,\r\n    /*\r\n    CMD_CTRL_NOOP: 0x80,\r\n    CMD_CTRL_IDENTIFY: 0x81,\r\n    CMD_CTRL_RESET: 0x82,\r\n    */\r\n}\r\n\r\nconst generic_regs: U.SMap<number> = {\r\n    REG_INTENSITY: 0x01,\r\n    REG_VALUE: 0x02,\r\n    REG_IS_STREAMING: 0x03,\r\n    REG_STREAMING_INTERVAL: 0x04,\r\n    REG_LOW_THRESHOLD: 0x05,\r\n    REG_HIGH_THRESHOLD: 0x06,\r\n    REG_MAX_POWER: 0x07,\r\n    REG_READING: 0x101\r\n}\r\n\r\nconst serv_decoders: U.SMap<(p: Packet) => string> = {\r\n    LOGGER: (pkt: Packet) => {\r\n        const pri = priority()\r\n        if (!pri) return null\r\n        return `${pri} \"${U.bufferToString(pkt.data)}\"`\r\n\r\n        function priority() {\r\n            switch (pkt.service_command) {\r\n                case 0x80: return \"dbg\"\r\n                case 0x81: return \"log\"\r\n                case 0x82: return \"warn\"\r\n                case 0x83: return \"err\"\r\n                default: return null\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction reverseLookup(map: U.SMap<number>, n: number) {\r\n    for (let k of Object.keys(map)) {\r\n        if (map[k] == n)\r\n            return k\r\n    }\r\n    return toHex(n)\r\n}\r\n\r\nfunction serviceName(n: number) {\r\n    if (n == null)\r\n        return \"?\"\r\n    return reverseLookup(service_classes, n)\r\n}\r\n\r\nfunction commandName(n: number) {\r\n    let pref = \"\"\r\n    if ((n & jd.CMD_TOP_MASK) == jd.CMD_SET_REG) pref = \"SET[\"\r\n    else if ((n & jd.CMD_TOP_MASK) == jd.CMD_GET_REG) pref = \"GET[\"\r\n    if (pref) {\r\n        const reg = n & jd.CMD_REG_MASK\r\n        return pref + reverseLookup(generic_regs, reg) + \"]\"\r\n    }\r\n    return reverseLookup(generic_commands, n)\r\n}\r\n\r\n\r\nfunction toHex(n: number) {\r\n    return \"0x\" + n.toString(16)\r\n}\r\n\r\n\r\nfunction num2str(n: number) {\r\n    return n + \" (0x\" + n.toString(16) + \")\"\r\n}\r\n\r\nexport interface Options {\r\n    skipRepeatedAnnounce?: boolean;\r\n    skipRepeatedReading?: boolean;\r\n}\r\n\r\nexport function printPacket(pkt: Packet, opts: Options = {}): string {\r\n    const frame_flags = pkt._header[3]\r\n\r\n    let devname = pkt.dev ? pkt.dev.name || pkt.dev.shortId : pkt.device_identifier\r\n\r\n    if (frame_flags & jd.JD_FRAME_FLAG_IDENTIFIER_IS_SERVICE_CLASS)\r\n        devname = \"[mul] \" + serviceName(pkt.multicommand_class)\r\n\r\n    const serv_id = serviceName(pkt?.dev?.serviceAt(pkt.service_number))\r\n    let service_name = `${serv_id} (${pkt.service_number})`\r\n    const cmd = pkt.service_command\r\n    let cmdname = commandName(cmd)\r\n    if (pkt.service_number == jd.JD_SERVICE_NUMBER_CRC_ACK) {\r\n        service_name = \"CRC-ACK\"\r\n        cmdname = toHex(cmd)\r\n    }\r\n    if (pkt.service_number == jd.JD_SERVICE_NUMBER_STREAM) {\r\n        service_name = \"STREAM\"\r\n        cmdname = `port:${cmd >> jd.STREAM_PORT_SHIFT} cnt:${cmd & jd.STREAM_COUNTER_MASK}`\r\n        if (cmd & jd.STREAM_METADATA_MASK)\r\n            cmdname += \" meta\"\r\n        if (cmd & jd.STREAM_CLOSE_MASK)\r\n            cmdname += \" close\"\r\n    }\r\n\r\n    let pdesc = `${devname}/${service_name}: ${cmdname}; sz=${pkt.size}`\r\n\r\n    if (frame_flags & jd.JD_FRAME_FLAG_COMMAND)\r\n        pdesc = 'to ' + pdesc\r\n    else\r\n        pdesc = 'from ' + pdesc\r\n    if (frame_flags & jd.JD_FRAME_FLAG_ACK_REQUESTED)\r\n        pdesc = `[ack:${toHex(pkt.crc)}] ` + pdesc\r\n\r\n    const d = pkt.data\r\n    if (pkt.dev && pkt.service_number == 0 && pkt.service_command == jd.CMD_ADVERTISEMENT_DATA) {\r\n        if (pkt.dev.lastServiceUpdate < pkt.timestamp) {\r\n            if (opts.skipRepeatedAnnounce)\r\n                return \"\"\r\n            else\r\n                pdesc = \" ====== \" + pdesc\r\n        } else {\r\n            const services = []\r\n            for (let i = 0; i < pkt.dev.services.length >> 2; i++) {\r\n                services.push(serviceName(pkt.dev.serviceAt(i)))\r\n            }\r\n            pdesc += \"; \" + \"Announce services: \" + services.join(\", \")\r\n        }\r\n    } else {\r\n        if (pkt.dev && !pkt.is_command && pkt.service_command == (jd.CMD_GET_REG | jd.REG_READING)) {\r\n            if (opts.skipRepeatedReading && pkt.dev.currentReading && U.bufferEq(pkt.dev.currentReading, pkt.data))\r\n                return \"\"\r\n            pkt.dev.currentReading = pkt.data\r\n        }\r\n\r\n        const decoder = serv_decoders[serv_id]\r\n        const decoded = decoder ? decoder(pkt) : null\r\n        if (decoded) {\r\n            pdesc += \"; \" + decoded\r\n        } else if (pkt.service_command == jd.CMD_EVENT) {\r\n            pdesc += \"; ev=\" + num2str(pkt.intData) + \" arg=\" + (U.read32(pkt.data, 4) | 0)\r\n        } else if (0 < d.length && d.length <= 4) {\r\n            let v0 = pkt.uintData, v1 = pkt.intData\r\n            pdesc += \"; \" + num2str(v0)\r\n            if (v0 != v1)\r\n                pdesc += \"; signed: \" + num2str(v1)\r\n        } else if (d.length) {\r\n            pdesc += \"; \" + U.toHex(d)\r\n        }\r\n    }\r\n\r\n    return Math.round(pkt.timestamp) + \"ms: \" + pdesc\r\n}\r\n\r\nexport interface ParsedFrame {\r\n    timestamp: number\r\n    data: Uint8Array\r\n    info?: string\r\n}\r\n\r\nexport function parseLog(logcontents: string) {\r\n    const res: ParsedFrame[] = []\r\n    let frameBytes = []\r\n    let lastTime = 0\r\n    for (let ln of logcontents.split(/\\r?\\n/)) {\r\n        let m = /^JD (\\d+) ([0-9a-f]+)/i.exec(ln)\r\n        if (m) {\r\n            res.push({\r\n                timestamp: parseInt(m[1]),\r\n                data: U.fromHex(m[2])\r\n            })\r\n            continue\r\n        }\r\n\r\n        m = /^([\\d\\.]+),Async Serial,.*(0x[A-F0-9][A-F0-9])/.exec(ln)\r\n        if (!m)\r\n            continue\r\n        const tm = parseFloat(m[1])\r\n        if (lastTime && tm - lastTime > 0.1) {\r\n            res.push({\r\n                timestamp: lastTime * 1000,\r\n                data: new Uint8Array(frameBytes),\r\n                info: \"timeout\"\r\n            })\r\n            frameBytes = []\r\n            lastTime = 0\r\n        }\r\n\r\n        lastTime = tm\r\n        if (ln.indexOf(\"framing error\") > 0) {\r\n            if (frameBytes.length > 0)\r\n                res.push({\r\n                    timestamp: lastTime * 1000,\r\n                    data: new Uint8Array(frameBytes),\r\n                })\r\n            frameBytes = []\r\n            lastTime = 0\r\n        } else {\r\n            frameBytes.push(parseInt(m[2]))\r\n        }\r\n    }\r\n\r\n    return res\r\n}\r\n\r\n"],"names":["U.delay","U.assert","U.PromiseBuffer","U.PromiseQueue","U.memcpy","U.write32","U.write16","U.read16","U.encodeU32LE","U.read32","U.bufferToString","toHex","jd.CMD_TOP_MASK","jd.CMD_SET_REG","jd.CMD_GET_REG","jd.CMD_REG_MASK","jd.JD_FRAME_FLAG_IDENTIFIER_IS_SERVICE_CLASS","jd.JD_SERVICE_NUMBER_CRC_ACK","jd.JD_SERVICE_NUMBER_STREAM","jd.STREAM_PORT_SHIFT","jd.STREAM_COUNTER_MASK","jd.STREAM_METADATA_MASK","jd.STREAM_CLOSE_MASK","jd.JD_FRAME_FLAG_COMMAND","jd.JD_FRAME_FLAG_ACK_REQUESTED","jd.CMD_ADVERTISEMENT_DATA","jd.REG_READING","U.bufferEq","jd.CMD_EVENT","U.toHex","U.fromHex"],"mappings":"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"}